-- -------------------------------------------------------------
-- 
-- File Name: C:\QPSK\hdl_prj_zcu111\hdlsrc\hdlcoder_QPSKTxRx_RFSoC\QPSK_src_Sync_Controller.vhd
-- Created: 2025-09-17 13:27:53
-- 
-- Generated by MATLAB 25.1, HDL Coder 25.1, and Simulink 25.1
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: QPSK_src_Sync_Controller
-- Source Path: hdlcoder_QPSKTxRx_RFSoC/QPSK/To DMA/Sync Controller
-- Hierarchy Level: 2
-- Model version: 9.4
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;

ENTITY QPSK_src_Sync_Controller IS
  PORT( clk                               :   IN    std_logic;
        reset                             :   IN    std_logic;
        enb                               :   IN    std_logic;
        stream_last                       :   IN    std_logic;
        capture_mode                      :   IN    std_logic_vector(1 DOWNTO 0);  -- ufix2
        capture_length                    :   IN    std_logic_vector(31 DOWNTO 0);  -- uint32
        freerun_enable                    :   OUT   std_logic;
        trigger_enable                    :   OUT   std_logic;
        capture_length_active             :   OUT   std_logic_vector(31 DOWNTO 0)  -- uint32
        );
END QPSK_src_Sync_Controller;


ARCHITECTURE rtl OF QPSK_src_Sync_Controller IS

  -- Component Declarations
  COMPONENT QPSK_src_MATLAB_Function_block
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb                             :   IN    std_logic;
          mode_in                         :   IN    std_logic_vector(1 DOWNTO 0);  -- ufix2
          length_in                       :   IN    std_logic_vector(31 DOWNTO 0);  -- uint32
          last_in                         :   IN    std_logic;
          freerun_enable                  :   OUT   std_logic;
          freerun_enable_update           :   OUT   std_logic;
          trigger_enable                  :   OUT   std_logic;
          length_out                      :   OUT   std_logic_vector(31 DOWNTO 0)  -- uint32
          );
  END COMPONENT;

  -- Component Configuration Statements
  FOR ALL : QPSK_src_MATLAB_Function_block
    USE ENTITY work.QPSK_src_MATLAB_Function_block(rtl);

  -- Signals
  SIGNAL freerun_enable_1                 : std_logic;
  SIGNAL freerun_enable_update            : std_logic;
  SIGNAL length_out                       : std_logic_vector(31 DOWNTO 0);  -- ufix32

BEGIN
  u_MATLAB_Function : QPSK_src_MATLAB_Function_block
    PORT MAP( clk => clk,
              reset => reset,
              enb => enb,
              mode_in => capture_mode,  -- ufix2
              length_in => capture_length,  -- uint32
              last_in => stream_last,
              freerun_enable => freerun_enable_1,
              freerun_enable_update => freerun_enable_update,
              trigger_enable => trigger_enable,
              length_out => length_out  -- uint32
              );

  -- Have to put register outside of ML Fcn block, 
  -- otherwise Simulink sees an algebraic loop
  Unit_Delay_Enabled_Synchronous_process : PROCESS (clk)
  BEGIN
    IF clk'EVENT AND clk = '1' THEN
      IF reset = '1' THEN
        freerun_enable <= '0';
      ELSIF enb = '1' AND freerun_enable_update = '1' THEN
        freerun_enable <= freerun_enable_1;
      END IF;
    END IF;
  END PROCESS Unit_Delay_Enabled_Synchronous_process;


  capture_length_active <= length_out;

END rtl;

